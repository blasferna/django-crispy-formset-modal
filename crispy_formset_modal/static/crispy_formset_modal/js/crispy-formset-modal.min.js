!function(t){"use strict";let e=window.gettext;const s=Object.prototype.hasOwnProperty;function i(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return`${t()+t()}-${t()}-${(4095&parseInt(t(),16)|16384).toString(16)}-${(16383&parseInt(t(),16)|32768).toString(16)}-${t()+t()+t()}`}function o(t){let e="";if("select"===t.tagName.toLowerCase()){let s=document.createElement("div");t.options[t.selectedIndex]?s.innerHTML=t.options[t.selectedIndex].innerText:s.innerHTML="-------",e=s.innerText.split("\n").map((t=>t.trim())).join(" ").trim()}else i=t,o="inputmask",s.call(i,o)?e=t.inputmask.undoValue:"date"==t.getAttribute("type")?t.value&&(e=t.value):e="checkbox"==t.getAttribute("type")?t.checked?"on":"off":t.value;var i,o;return e}function r(){window.hasOwnProperty("calculatedFields")&&calculatedFields.forEach((function(t){t.executeAll()}))}function a(){window.hasOwnProperty("calculatedFields")&&window.calculatedFields.forEach((function(t){let e=t.field,s=e.getAttribute("id");document.querySelector("td[data-source='"+s+"']")&&(e.hasAttribute("data-event")||(e.addEventListener("oncalculate",(function(){let t=o(e),i=document.querySelector("td[data-source='"+s+"']");i&&(i.innerText=t)})),e.setAttribute("data-event",!0)))}))}function n(t,e){return!!e.some((e=>e.id===t))&&e.find((e=>e.id===t))}window.django&&window.django.jsi18n_initialized||(e=t=>t);const l={hidden:"d-none",inlineFlex:"d-inline-flex",flex:"d-flex",relative:"position-relative",textRight:"text-right",textCenter:"text-center",alignMiddle:"align-middle",pointer:"cfm-cursor-pointer",checkbox:"checkbox",td:"cfm-td",tr:"cfm-tr",selectionMark:"cfm-selection-border",p0:"p-0",opacity50:"cfm-opacity-50",opacity100:"cfm-opacity-100",backdrop:"cfm-modal-backdrop",justifyStart:"justify-content-start",justifyCenter:"justify-content-center",justifyEnd:"justify-content-end",itemsStart:"align-items-start",itemsCenter:"align-items-center",itemsEnd:"align-items-end"},d={sm:"modal-sm",md:"modal-md",lg:"modal-lg",xl:"modal-xl"},c={bootstrap4:{classes:l,sizes:d},bootstrap5:{classes:{...l,textRight:"text-end",checkbox:"checkbox form-check-input"},sizes:d},tailwind:{classes:{hidden:"hidden",inlineFlex:"inline-flex",flex:"flex",relative:"relative",textRight:"text-right",textCenter:"text-center",alignMiddle:"align-middle",pointer:"cursor-pointer",checkbox:"w-4 rounded border-gray-300 focus:ring-indigo-500 text-indigo-600 h-4",td:"whitespace-nowrap px-3 py-3 text-sm text-gray-500",tr:"divide-x divide-gray-200 border-b",selectionMark:"absolute inset-y-0 left-0 w-0.5 bg-indigo-600 selection-border",p0:"p-0",opacity50:"opacity-50",opacity100:"opacity-100",backdrop:"transition-opacity ease-in-out duration-300 opacity-0 bg-gray-800 fixed inset-0 z-40",justifyStart:"justify-start",justifyCenter:"justify-center",justifyEnd:"justify-end",itemsStart:"items-start",itemsCenter:"items-center",itemsEnd:"items-end"},sizes:{sm:"max-w-lg",md:"max-w-4xl",lg:"max-w-5xl",xl:"max-w-6xl"}},bulma:{classes:{hidden:"is-hidden",inlineFlex:"is-inline-flex",flex:"is-flex",relative:"is-relative",textRight:"has-text-right",textCenter:"has-text-center",alignMiddle:"is-vcentered",pointer:"cfm-cursor-pointer",checkbox:"checkbox",td:"cfm-td",tr:"cfm-tr",selectionMark:"cfm-selection-border",p0:"p-0",opacity50:"cfm-opacity-50",opacity100:"cfm-opacity-100",backdrop:"cfm-modal-backdrop",justifyStart:"is-justify-content-start",justifyCenter:"is-justify-content-center",justifyEnd:"is-justify-content-end",itemsStart:"is-align-items-start",itemsCenter:"is-align-items-center",itemsEnd:"is-align-items-end"},sizes:{sm:"modal-sm",md:"modal-md",lg:"modal-lg",xl:"modal-xl"}}},m="formset";class h{constructor(e,s){var o=this;this.opts=t.extend({},h.defaults,s),this.$formset=t(e),this.$formset.attr("data-uuid",i()),this.$emptyForm=this.$formset.find(this.opts.emptyForm),this.$body=this.$formset.find(this.opts.body),this.$add=this.$formset.find(this.opts.add),this.formsetPrefix=t(e).data("formset-prefix"),this.addForm=t.proxy(this,"addForm"),this.$add.click(this.addForm),this.$formset.on("formAdded formDeleted",this.opts.form,t.proxy(this,"checkMaxForms")),this.$forms().each((function(e,s){t(s),o.bindForm(t(this),e)})),this.$formset.data(m,this);t.each(["animateForms"],(function(t,e){e in o.opts&&o.opts[e]&&o[e]()}))}static getOrCreate(e,s){var i=t(e).data(m);return i||(i=new h(e,s)),i}addForm(){if(this.hasMaxForms())throw new Error("MAX_NUM_FORMS reached");var e=this.totalFormCount();this.$managementForm("TOTAL_FORMS").val(e+1);var s=this.$emptyForm.html().replace(new RegExp("__prefix__","g"),e).replace(new RegExp("<\\\\/script>","g"),"<\/script>"),i=t(t.parseHTML(s,this.$body.document,!0));this.$body.append(i);var o=i.filter(this.opts.form);return this.bindForm(o,e),this.opts.newFormCallback&&this.opts.newFormCallback(o),o}bindForm(e,s){var i=this.formsetPrefix+"-"+s;e.data(m+"__formPrefix",i);var o=e.find("[name="+i+"-DELETE]");o.change((function(s){o.is(":checked")?(e.attr("data-formset-form-deleted",""),e.find(":required").data(m+"-required-field",!0).prop("required",!1),e.find("input[pattern]").each((function(){var e=t(this).attr("pattern");t(this).data(m+"-field-pattern",e).removeAttr("pattern")})),e.trigger("formDeleted")):(e.removeAttr("data-formset-form-deleted"),e.find("*").filter((function(){return!0===t(this).data(m+"-required-field")})).prop("required",!0),e.find("input").each((function(){var e=t(this).data(m+"-field-pattern");e&&t(this).attr("pattern",e)})),e.trigger("formAdded"))})).trigger("change"),e.find(this.opts.deleteButton).bind("click",(function(){o.attr("checked",!0).change()}))}$forms(){return this.$body.find(this.opts.form)}$managementForm(t){return this.$formset.find("[name="+this.formsetPrefix+"-"+t+"]")}totalFormCount(){return this.$forms().length}deletedFormCount(){return this.$forms().filter("[data-formset-form-deleted]").length}clear(){this.$forms().each((function(e,s){t(s).find(":input").not(":button, :submit, :reset, :hidden, :checkbox, :radio").val("")}))}deleteAll(){this.$forms().each((function(e,s){t(s).find("[deletecheckbox]").prop("checked",!0).change()}))}activeFormCount(){return this.totalFormCount()-this.deletedFormCount()}openRownum(){var t=this.$formset.find("tr.row-open").attr("data-rownum");return null!=typeof t?parseInt(t):0}hasMaxForms(){var t=parseInt(this.$managementForm("MAX_NUM_FORMS").val(),10)||1e3;return this.activeFormCount()>=t}checkMaxForms(){this.hasMaxForms()?(this.$formset.addClass(this.opts.hasMaxFormsClass),this.$add.attr("disabled","disabled")):(this.$formset.removeClass(this.opts.hasMaxFormsClass),this.$add.removeAttr("disabled"))}animateForms(){this.$formset.on("formAdded",this.opts.form,(function(){var e=t(this);e.slideUp(0),e.slideDown()})).on("formDeleted",this.opts.form,(function(){t(this).slideUp()})),this.$forms().filter("[data-formset-form-deleted]").slideUp(0)}}h.defaults={form:"[data-formset-form]",emptyForm:"script[type=form-template][data-formset-empty-form]",body:"[data-formset-body]",add:"[data-formset-add]",deleteButton:"[data-formset-delete-button]",hasMaxFormsClass:"has-max-forms",animateForms:!1,newFormCallback:!1};const u={placement:"center",size:"md",templatePack:null,onHide:()=>{},onShow:()=>{},onToggle:()=>{}};class f{constructor(t=null,e={}){this._targetEl=t,this._parentEl=t.parentElement,this._options={...u,...e},this._isHidden=!0,this._bsParent=this._parentEl.closest(".modal"),this._init(),this._addEventListeners()}_init(){this._getPlacementClasses().map((t=>{this._targetEl.classList.add(t)})),this._clearSize(),this._getSizeClasses().map((t=>{this._targetEl.firstElementChild.classList.add(t)}))}_createBackdrop(t){if(this._isHidden){const e=document.createElement("div");e.setAttribute("data-ref-id",t),e.setAttribute("modal-backdrop",""),e.classList.add(...this._getClasses("backdrop")),this._parentEl.append(e),e.offsetWidth,e.classList.add(...this._getClasses("opacity50"))}}_destroyBackdropEl(){if(!this._isHidden){let t=this._targetEl.getAttribute("data-ref-id");document.querySelector(`[modal-backdrop][data-ref-id="${t}"]`).remove()}}_getPlacementClasses(){let t=this;switch(this._options.placement){case"top-left":return[t._getClasses("justifyStart",!1),t._getClasses("itemsStart",!1)];case"top-center":return[t._getClasses("justifyCenter",!1),t._getClasses("itemsStart",!1)];case"top-right":return[t._getClasses("justifyEnd",!1),t._getClasses("itemsStart",!1)];case"center-left":return[t._getClasses("justifyStart",!1),t._getClasses("itemsCenter",!1)];case"center":default:return[t._getClasses("justifyCenter",!1),t._getClasses("itemsCenter",!1)];case"center-right":return[t._getClasses("justifyEnd",!1),t._getClasses("itemsCenter",!1)];case"bottom-left":return[t._getClasses("justifyStart",!1),t._getClasses("itemsEnd",!1)];case"bottom-center":return[t._getClasses("justifyCenter",!1),t._getClasses("itemsEnd",!1)];case"bottom-right":return[t._getClasses("justifyEnd",!1),t._getClasses("itemsEnd",!1)]}}_getSizeClasses(){return c[this._options.templatePack].sizes[this._options.size].split(" ")}_getClasses(t,e=!1){let s=c[this._options.templatePack].classes[t];return e?s:s.split(" ")}_clearSize(){const t=this._targetEl.firstElementChild,e=c[this._options.templatePack].sizes;for(const s in e)e.hasOwnProperty(s)&&t.classList.remove(e[s])}_addEventListeners(){let t=this;this._targetEl.addEventListener("keyup",(function(e){27===e.which&&(e.preventDefault(),t.hide())}))}toggle(){this._isHidden?this.show():this.hide(),this._options.onToggle(this)}show(){const e=i();this._targetEl.classList.add(...this._getClasses("flex")),this._targetEl.classList.remove(...this._getClasses("hidden")),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._targetEl.setAttribute("data-ref-id",e),this._createBackdrop(e),this._isHidden=!1,document.body.classList.add("modal-open"),this._options.onShow(this);let s=this._targetEl.querySelector('select, input:not([type="hidden"]');s&&(s.setAttribute("tabindex","0"),s.focus()),this._targetEl.offsetWidth,this._targetEl.classList.add(...this._getClasses("opacity100")),this._bsParent&&t(this._bsParent).off("keydown.dismiss.bs.modal")}hide(){this._targetEl.classList.add(...this._getClasses("hidden")),this._targetEl.classList.remove(...this._getClasses("flex")),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._destroyBackdropEl(),this._isHidden=!0,document.body.classList.remove("modal-open"),this._options.onHide(this),this._bsParent&&(this._bsParent.focus(),t(this._bsParent).on("keydown.dismiss.bs.modal",(e=>{27===e.which&&(e.preventDefault(),t(this._bsParent).modal("hide"))})))}}const p={parent:null,modalId:null,onKeyUp:function(){},onClose:function(){},onOpen:function(){}};class g{constructor(t,e={}){this.targetEl=t,this._options={...p,...e},this.modalId=this._options.modalId,this._modalEl=null,this._modalTitleEl=null,this._modalDeleteBt=null,this.modalInstance=!1,this.rownum=null,this._init(),this._addEvents()}_init(){this._modalEl=document.getElementById(this.modalId),this._modalTitleEl=this._modalEl.querySelector(".modal-title"),this._modalDeleteBt=this._modalEl.querySelector(".formset-delete"),this._createModal()}_addEvents(){let t=this;this._modalEl.querySelectorAll('[data-formset-modal-toggle="'+this.modalId+'"]').forEach((function(e){e.addEventListener("click",(function(){t.close()}))}))}hasFieldError(t){let e=this.targetEl.querySelector(`#div_${t}`),s=!1,i="";return e.querySelectorAll("[id^='error_']").forEach((function(t){s=!0,i=t.innerText})),{error:s,text:i}}hasNonFieldError(){return null!=this.targetEl.querySelector(".non-field-errors")}errors(){let t={};return this.targetEl.querySelectorAll("[id^='error_']").forEach((function(e){let s=e.id.replace("error_",""),i=s.replace(/.*?-.*?-(.*)/,"$1");t[i]={error:e.innerText,sourceId:s}})),t}hasErrorsNotIncluded(t,e){let s=Object.keys(t).filter((t=>!e.hasOwnProperty(t))),i=Object.values(e).every((t=>!t.hasError||!t.hasError.error));return s.length>0&&i}_hiddeDefaultDeleteBt(t){t.parentNode.classList.add("d-none")}_createModal(){let t=this;if(!this.modalInstance){let e=this.targetEl.querySelector(".formset-delete"),s=new f(this._modalEl,{placement:t._options.placement,size:t._options.size,templatePack:t._options.templatePack,onHide:function(e){t._onModalClose(e)},onShow:function(e){t._onModalShow(e)}});s._targetEl.addEventListener("keyup",(function(e){t._options.onKeyUp(e,t)})),this.modalInstance=s,this._hiddeDefaultDeleteBt(e)}}_onModalShow(t){this._options.onOpen(this);let s=this._options.parent.targetEl.querySelector(".btn-open-row[data-formset-modal-toggle='"+this.modalId+"']").closest("tr");this._modalTitleEl.innerText=e("Editing row #")+this.rownum,s.classList.add("row-open")}_onModalClose(t){this._options.onClose(this);let e=this._options.parent.targetEl.querySelector(".btn-open-row[data-formset-modal-toggle='"+this.modalId+"']");if(e){e.closest("tr").classList.remove("row-open")}}isDeleted(){return this.targetEl.hasAttribute("data-formset-form-deleted")}isSelected(){return this.targetEl.hasAttribute("data-formset-form-selected")}open(){this.modalInstance.show()}close(){this.modalInstance.hide()}}const _="tabular",y="modal";class b{constructor(t){this._id=t,this.targetEl=document.getElementById(this._id),this.variant=_,this.$formset=null,this._modalForms=[],this._deleteBt=null,this._table=null,this._tbody=null,this._tfoot=null,this._init(),this._addEvents()}_init(){this.variant=this._getVariant(),this.templatePack=this._getTemplatePack(),this.modalSize=this._getModalSize(),this.modalPlacement=this._getModalPlacement(),this.$formset=t(`#${this._id}`),this.$formset.formset({animateForms:!0}),this.variant!==y&&this.variant!=_||(this._table=this.targetEl.querySelector("table"),this._tbody=this._table.querySelector("tbody"),this._tfoot=this._table.querySelector("tfoot"),this._emptyState=this._tbody.innerHTML),this.variant===y&&(this._deleteBt=this.targetEl.querySelector(".delete-selected"),this._checkInitials(),this._configureSelectAllToggler(),this._refresh()),this.targetEl.setAttribute("data-formset-initialized","true")}_getVariant(){return this.targetEl.getAttribute("data-formset-variant")}_getTemplatePack(){return this.targetEl.getAttribute("data-template-pack")}_getClasses(t){return c[this.templatePack].classes[t].split(" ")}_getEditButton(t){const e=this.targetEl.querySelector("template").content.cloneNode(!0).querySelector("button");return e.classList.contains("btn-open-row")||e.classList.add("btn-open-row"),e.setAttribute("data-formset-modal-toggle",t),e}_getModalSize(){return this.targetEl.getAttribute("data-modal-size")}_getModalPlacement(){return this.targetEl.getAttribute("data-modal-placement")}_getModalFormInstanceByRownum(t){let e=!1;return this._modalForms.forEach((function(s){s.rownum!==t||s.isDeleted()||(e=s)})),e}_addEvents(){let t=this;this.$formset.on("formAdded",(function(e){t._onFormsetAdded(e),window.crispyFormsetModal.onFormAdded(e)})),this.$formset.on("formDeleted",(function(e){t._onFormsetDeleted(e),window.crispyFormsetModal.onFormDeleted(e)})),this.targetEl.addEventListener("click",(function(e){e.target.closest("[data-formset-previous-button]")&&(e.preventDefault(),t._navigateToPrevious()),e.target.closest("[data-formset-next-button]")&&(e.preventDefault(),t._navigateToNext())}))}_navigateToPrevious(){let t=this._getCurrentOpenModalForm();t&&this._navigateUp(t)}_navigateToNext(){let t=this._getCurrentOpenModalForm();t&&this._navigateDown(t)}_navigateUp(t){let e=t.rownum;if(e>1){t.close(),this._getModalFormInstanceByRownum(e-1).open()}}_navigateDown(t){let e=t.rownum,s=this.$formset.formset("getOrCreate"),i=s.activeFormCount();if(e<i){t.close(),this._getModalFormInstanceByRownum(e+1).open()}else e==i&&(t.close(),s.addForm())}_getCurrentOpenModalForm(){return this._modalForms.find((t=>!t.isDeleted()&&!t.modalInstance._isHidden))}_updateNavigationButtons(t){let e=this.$formset.formset("getOrCreate").activeFormCount(),s=t.rownum,i=t._modalEl.querySelector("[data-formset-previous-button]"),o=t._modalEl.querySelector("[data-formset-next-button]"),r=t._modalEl.querySelector("[data-plus-icon]"),a=t._modalEl.querySelector("[data-next-icon]");i&&(s<=1?(i.disabled=!0,i.classList.add("disabled")):(i.disabled=!1,i.classList.remove("disabled"))),o&&s>=e?r&&a&&(a.style.display="none",r.style.display="inline"):r&&a&&(a.style.display="inline",r.style.display="none")}_checkInitials(){let t=this,e=[];this.targetEl.querySelectorAll("[data-formset-modal-toggle]").forEach((function(s){let i=s.closest("[data-formset-form]"),o=s.getAttribute("data-formset-modal-toggle");e.includes(o)||t._newModalForm(i,o),e.push(o)}))}_newModalForm(t,e){let s=this,i={parent:s,modalId:e,size:s.modalSize,placement:s.modalPlacement,templatePack:s.templatePack,onKeyUp:function(t,e){s._onModalFormKeyUp(t,e)},onOpen:function(t){s._onModalFormOpen(t)},onClose:function(t){s._onModalFormClose(t)}},o=new g(t,i);return s._modalForms.push(o),o}_onFormsetAdded(e){if(this.variant===y){let s=i();t(this.targetEl).find("#__dialog_id__").attr("id",s),t(this.targetEl).find('[data-formset-modal-toggle="__dialog_id__"]').attr("data-formset-modal-toggle",s),this._newModalForm(e.target,s).open()}window.hasOwnProperty("calculatedFields")&&(window.resetCalculatedFields(),a())}_onFormsetDeleted(){this.variant==y&&this._refresh(),r()}_onModalFormKeyUp(t,e){!t.ctrlKey||38!==t.keyCode&&40!==t.keyCode||(t.preventDefault(),38==t.keyCode&&this._navigateUp(e),40===t.keyCode&&this._navigateDown(e))}_onModalFormOpen(t){this._refresh(),window.crispyFormsetModal.onModalFormOpened(t),this._updateNavigationButtons(t)}_onModalFormClose(t){this._refresh(),window.crispyFormsetModal.onModalFormClosed(t)}_configureSelectAllToggler(){let t=this,e=this._table,s=this.targetEl.querySelector(".select-all"),i=this.targetEl.querySelector(".delete-selected");s.addEventListener("change",(function(i){let o=s.checked;e.querySelectorAll(".select-row").forEach((function(e){let s=e.closest("tr"),i=e.closest("td"),r=s.querySelector("[data-formset-modal-toggle]").getAttribute("data-formset-modal-toggle"),a=document.getElementById(r).closest("[data-formset-form]");e.checked=o,t._checker(s,i,a,e)}))})),i.addEventListener("click",(function(e){t.targetEl.querySelectorAll("[data-formset-form-selected]:not([data-formset-form-deleted])").forEach((function(t){let e=t.querySelector(".formset-delete");e.checked=!0,e.dispatchEvent(new Event("change"))}))}))}_checkSelectAllState(){let t=this._table,e=this.targetEl.querySelector(".delete-selected"),s=!1,i=t.querySelector(".select-all"),o=t.querySelectorAll("tbody tr").length,r=t.querySelectorAll("tr.selected").length;r===o&&o>0?(i.checked=!0,i.indeterminate=!1,s=!0):(r!=o&&r>0&&(i.indeterminate=!0,i.checked=!1,s=!0),0===r&&(i.checked=!1,i.indeterminate=!1,s=!1)),s?(e.classList.remove(...this._getClasses("hidden")),e.classList.add(...this._getClasses("inlineFlex"))):(e.classList.remove(...this._getClasses("inlineFlex")),e.classList.add(...this._getClasses("hidden")))}_checker(t,e,s,i){let o=e.querySelector(".cfm-selection-border, .selection-border");if(o&&o.remove(),i.checked){let i=document.createElement("div");e.classList.add(...this._getClasses("relative")),i.classList.add(...this._getClasses("selectionMark")),e.prepend(i),s.setAttribute("data-formset-form-selected","selected"),t.classList.add("selected")}else i.classList.remove(...this._getClasses("relative")),t.classList.remove("selected"),s.removeAttribute("data-formset-form-selected");this._checkSelectAllState()}_refresh(){let t=this,e={},s=[],i=[];this._table.querySelectorAll("[data-field-name]").forEach((function(t){e[t.getAttribute("data-field-name")]={type:t.getAttribute("data-field-type"),hasSummary:t.hasAttribute("data-field-summary"),summary:0}})),s=Object.keys(e),this._modalForms.forEach((function(t){if(!t.isDeleted()){let e={};t.targetEl.querySelectorAll("input, select, textarea").forEach((function(i){let r=i.name.match(/(?<form>\w+)-(?<number>\w+)-(?<name>\w+)/);if(r){let a=r.groups.name;if(s.includes(a)){let s=o(i);e[a]={value:s,sourceId:i.getAttribute("id"),hasError:t.hasFieldError(i.getAttribute("id"))},e.modalForm=t}}})),i.push(e)}})),function(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild)}(this._tbody),0===i.length&&(this._tbody.innerHTML=this._emptyState);let r=1;i.forEach((function(i){i.modalForm.rownum=r;let o=document.createElement("tr");o.classList.add(...t._getClasses("tr")),o.setAttribute("data-rownum",r),(i.modalForm.hasNonFieldError()||i.modalForm.hasErrorsNotIncluded(i.modalForm.errors(),i))&&(o.style="border: 2px solid #ff4545");let a=document.createElement("td");a.style.textAlign="center";let n=document.createElement("input");n.setAttribute("type","checkbox"),n.classList.add(...t._getClasses("checkbox")),n.classList.add("select-row"),a.appendChild(n),a.classList.add(...t._getClasses("td")),n.addEventListener("change",(function(e){t._checker(o,a,i.modalForm.targetEl,e.target)})),o.appendChild(a);let l=document.createElement("td");l.classList.add(...t._getClasses("td")),l.classList.add(...t._getClasses("textRight")),l.classList.add(...t._getClasses("pointer")),l.innerText=r,l.addEventListener("click",(function(){i.modalForm.open()})),o.appendChild(l),s.forEach((function(s){let r=document.createElement("td"),a=i[s].hasError;if(r.classList.add(...t._getClasses("td")),a.error&&(r.style="border: 2px solid #ff4545",r.title=a.text),"bool"===e[s].type){let e="on"===i[s].value?"checked":"";r.innerHTML=`<input type="checkbox" class="${t._getClasses("checkbox").join(" ")}" ${e} disabled></input>`}else r.innerText=i[s].value;var n;"numeric"===e[s].type&&(r.classList.add(...t._getClasses("textRight")),e[s].hasSummary&&(e[s].summary=e[s].summary+(n=i[s].value,Number(n)))),"bool"!==e[s].type&&"date"!=e[s].type||r.classList.add(...t._getClasses("textCenter")),r.setAttribute("data-source",i[s].sourceId),o.appendChild(r)}));let d=document.createElement("td");d.classList.add(...t._getClasses("td")),d.classList.add(...t._getClasses("textCenter")),d.classList.add(...t._getClasses("p0")),d.classList.add(...t._getClasses("alignMiddle")),d.appendChild(t._getEditButton(i.modalForm.modalId)),d.querySelector(".btn-open-row").addEventListener("click",(function(t){i.modalForm.open()})),o.appendChild(d),t._tbody.appendChild(o),i.modalForm.isSelected()&&(n.checked=!0,t._checker(o,a,i.modalForm.targetEl,n)),r++})),this._tfoot&&this._tfoot.querySelectorAll("[data-summary-column]").forEach((function(t){let s=e[t.getAttribute("data-summary-column")].summary;t.innerText=s})),this._checkSelectAllState()}}function E(){document.querySelectorAll(".formset").forEach((function(t){t.hasAttribute("data-formset-initialized")||new b(t.getAttribute("id"))}))}function w(){let t=[];document.querySelectorAll("[data-modal-toggle]").forEach((e=>{const s=e.getAttribute("data-modal-toggle"),i=document.getElementById(s),o=i.getAttribute("data-modal-placement");i&&(i.hasAttribute("aria-hidden")||i.hasAttribute("aria-modal")||i.setAttribute("aria-hidden","true"));let r=null;n(s,t)?(r=n(s,t),r=r.object):(r=new f(i,{placement:o||Default.placement}),t.push({id:s,object:r})),i.hasAttribute("data-modal-show")&&"true"===i.getAttribute("data-modal-show")&&r.show(),e.addEventListener("click",(()=>{r.toggle()}))}))}var C;window.crispyFormsetModal={},t.fn[m]=function(){var e,s,i;if(0===arguments.length||1===arguments.length&&"string"!=t.type(arguments[0]))return e=arguments[0],this.each((function(){return h.getOrCreate(this,e)}));if(s=arguments[0],i=t.makeArray(arguments).slice(1),s in h)return i.unshift(this),h[s].apply(h,i);throw new Error("Unknown function call "+s+" for $.fn.formset")},window.crispyFormsetModal.init=function(){!function(){const t="cfm-styles";if(!document.getElementById(t)){const e="\n      .cfm-selection-border {\n          position: absolute;\n          top: 0px;\n          bottom: 0px;\n          left: 0px;\n          width: 0.150rem;\n          background-color: rgb(220 53 69 / 1);\n      }\n      .cfm-modal-backdrop {\n          position: fixed;\n          inset: 0px;\n          z-index: 1050;\n          background-color: rgb(31 41 55 / 1);\n          opacity: 0;\n          transition-property: opacity;\n          transition-duration: 300ms;\n          transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n      }\n      .cfm-opacity-50 {\n          opacity: 0.5;\n      }\n      .cfm-opacity-100 {\n          opacity: 1;\n      }\n      .cfm-tr.selected{\n        background-color: rgba(0, 0, 0, 0.08) !important;\n      }\n      .cfm .modal-body {\n        max-height: calc(100vh - 150px);\n        overflow-x: auto;\n      }\n      .cfm-cursor-pointer {\n        cursor: pointer;\n      }\n      [data-formset-form] .modal {\n        z-index: 1051;\n      }\n      ",s=document.createElement("style");s.innerHTML=e,s.id=t,document.head.appendChild(s)}}(),E(),w(),a(),r()},window.crispyFormsetModal.refresh=function(){E(),w(),a(),r()},window.crispyFormsetModal.onFormAdded=function(){},window.crispyFormsetModal.onFormDeleted=function(){},window.crispyFormsetModal.onModalFormOpened=function(){},window.crispyFormsetModal.onModalFormClosed=function(){},C=function(){window.crispyFormsetModal.init()},"loading"!==document.readyState?C():document.addEventListener("DOMContentLoaded",C)}($);
//# sourceMappingURL=crispy-formset-modal.min.js.map
